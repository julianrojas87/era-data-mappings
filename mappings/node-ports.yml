prefixes:
  wgs: "http://www.w3.org/2003/01/geo/wgs84_pos#"
  geosparql: "http://www.opengis.net/ont/geosparql#"
  rdfs: "http://www.w3.org/2000/01/rdf-schema#"
  era: "http://era.europa.eu/ns#"
  xsd: "http://www.w3.org/2001/XMLSchema#"
variables:
  connection: 
    access: &host ${RINF_HOST}
    type: &typeMSSQL mssql
    credentials: &credentials
      username: ${RINF_USER}
      password: ${RINF_PWD}
    queryFormulation: &queryFormulation sql2008 
    referenceFormulation: &referenceFormulation csv

mappings:
  departing-node-port:
    sources:
      - access: *host
        type: *typeMSSQL
        credentials: *credentials
        queryFormulation: *queryFormulation
        referenceFormulation: *referenceFormulation
        query: SELECT Tracks.UUID, LineNodes.Latitude, LineNodes.Longitude, (SELECT TRIM(UOPID) FROM RINF.dbo.OperationalPoints, RINF.dbo.LineNodes WHERE OperationalPointID=OperationalPoints.ID AND LineNodes.ID=LineEdges.LineNodeStartID AND OperationalPoints.VersionID=LineNodes.VersionID) AS FROM_NODE, (SELECT TRIM(UOPID) FROM RINF.dbo.OperationalPoints, RINF.dbo.LineNodes WHERE OperationalPointID=OperationalPoints.ID AND LineNodes.ID=LineEdges.LineNodeEndID AND OperationalPoints.VersionID=LineNodes.VersionID) AS TO_NODE FROM RINF.dbo.LineEdges, RINF.dbo.SectionOfLines, RINF.dbo.SOLTracks, RINF.dbo.Tracks, RINF.dbo.LineNodes WHERE LineEdges.LineNodeStartID = LineNodes.ID AND LineEdges.VersionID = LineNodes.VersionID AND LineEdges.ID = SectionOfLines.LineEdgeID AND LineEdges.VersionID = SectionOfLines.VersionID AND SectionOfLines.ID = SOLTracks.SectionOfLineID AND SOLTracks.VersionID = SectionOfLines.VersionID AND SOLTracks.TrackID = Tracks.ID AND SOLTracks.VersionID = Tracks.VersionID;
    s: http://era.europa.eu/abstraction#NP_$(FROM_NODE)_$(UUID)_$(TO_NODE)
    po:
      - [a, era:NodePort]
      - [rdfs:label, NP_$(FROM_NODE)_$(UUID)_$(TO_NODE)]
      - [wgs:lat, $(Latitude), xsd:double]
      - [wgs:long, $(Longitude), xsd:double]
      - [geosparql:asWKT, POINT ($(Longitude) $(Latitude)), geosparql:wktLiteral]
      - [era:belongsToNode, http://era.europa.eu/abstraction#MN_$(FROM_NODE)~iri]
  
  arriving-node-port:
    sources:
      - access: *host
        type: *typeMSSQL
        credentials: *credentials
        queryFormulation: *queryFormulation
        referenceFormulation: *referenceFormulation
        query: SELECT Tracks.UUID, LineNodes.Latitude, LineNodes.Longitude, (SELECT TRIM(UOPID) FROM RINF.dbo.OperationalPoints, RINF.dbo.LineNodes WHERE OperationalPointID=OperationalPoints.ID AND LineNodes.ID=LineEdges.LineNodeStartID AND OperationalPoints.VersionID=LineNodes.VersionID) AS FROM_NODE, (SELECT TRIM(UOPID) FROM RINF.dbo.OperationalPoints, RINF.dbo.LineNodes WHERE OperationalPointID=OperationalPoints.ID AND LineNodes.ID=LineEdges.LineNodeEndID AND OperationalPoints.VersionID=LineNodes.VersionID) AS TO_NODE FROM RINF.dbo.LineEdges, RINF.dbo.SectionOfLines, RINF.dbo.SOLTracks, RINF.dbo.Tracks, RINF.dbo.LineNodes WHERE LineEdges.LineNodeEndID = LineNodes.ID AND LineEdges.VersionID = LineNodes.VersionID AND LineEdges.ID = SectionOfLines.LineEdgeID AND LineEdges.VersionID = SectionOfLines.VersionID AND SectionOfLines.ID = SOLTracks.SectionOfLineID AND SOLTracks.VersionID = SectionOfLines.VersionID AND SOLTracks.TrackID = Tracks.ID AND SOLTracks.VersionID = Tracks.VersionID;
    s: http://era.europa.eu/abstraction#NP_$(TO_NODE)_$(UUID)_$(FROM_NODE)
    po:
      - [a, era:NodePort]
      - [rdfs:label, NP_$(TO_NODE)_$(UUID)_$(FROM_NODE)]
      - [wgs:lat, $(Latitude), xsd:double]
      - [wgs:long, $(Longitude), xsd:double]
      - [geosparql:asWKT, POINT ($(Longitude) $(Latitude)), geosparql:wktLiteral]
      - [era:belongsToNode, http://era.europa.eu/abstraction#MN_$(TO_NODE)~iri]